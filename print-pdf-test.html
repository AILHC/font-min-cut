<html>

<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>jsPDF custom fonts example</title>
    <script src="./lib/jspdf.js"></script>
    <script src="./lib/plugins/FileSaver.js"></script>
    <script src="./lib/plugins/split_text_to_size.js"></script>
    <script src="./lib/plugins/standard_fonts_metrics.js"></script>
    <script src="./lib/customfonts.js"></script>
    <script src="./lib/vfs_fonts_simsun.js"></script>
    <script src="./lib/jspdf.plugin.autotable.js"></script>
    <script src="./lib/faker.min.js"></script>

    <style>
        button {
            margin: 50px;
        }

        #output {
            width: 70%;
            height: 80%;
            margin: 20px;
            float: right;
            background: rgba(193, 193, 193, 1);
        }
    </style>
</head>

<body>
    <button>打印</button>
    <iframe id="output"></iframe>
</body>
<script>
    var getColumns = function () {
        return [
            { title: "ID", dataKey: "id" },
            // { title: "爱好hobit", dataKey: "hobit" },
            { title: "Name", dataKey: "name" },
            { title: "Name1", dataKey: "name1" },
            { title: "Email", dataKey: "email" },
            { title: "City", dataKey: "city" },
            { title: "Expenses", dataKey: "expenses" }
        ];
    };

    // Uses the faker.js library to get random data.
    function getData(rowCount) {
        rowCount = rowCount || 4;
        //var sentence = "Minima quis totam nobis nihil et molestiae architecto accusantium qui necessitatibus sit ducimus cupiditate qui ullam et aspernatur esse et dolores ut voluptatem odit quasi ea sit ad sint voluptatem est dignissimos voluptatem vel adipisci facere consequuntur et reprehenderit cum unde debitis ab cumque sint quo ut officiis rerum aut quia quia expedita ut consectetur animiqui voluptas suscipit Monsequatur";
        var sentence = faker.lorem.words(20);
        var data = [];
        for (var j = 1; j <= rowCount; j++) {
            data.push({
                id: j,
                name1: 'asdjkasdajkqwieoquwiadlaksdjaksd',
                hobit: "女nv",
                name: faker.name.findName(),
                email: faker.internet.email(),
                country: faker.address.country(),
                city: faker.address.city(),
                expenses: faker.finance.amount(),
                text: shuffleSentence(sentence),
                text2: faker.lorem.words(1)
            });
        }
        return data;
    }

    function shuffleSentence(words) {
        if (typeof words === 'string') return words;
        words = words || faker.lorem.words(8);
        var str = faker.helpers.shuffle(words).join(' ').trim();
        return str.charAt(0).toUpperCase() + str.slice(1);
    }

</script>
<script>
    function pdfGen() {
        var doc = new jsPDF();
        var totalPagesExp = "{total_pages_count_string}";


        doc.addFont('simsun.ttf', 'simsun', 'normal', 'Identity-H');

        doc.setFont('simsun'); // set font

        doc.drawText(20, 40, ' ⑤如果服务器要求客户的身份认证（在握手过程中为可选），用户可以建立一个随机数然后对其进行数据签名，将这个含有签名的随机数和客户自己的证书以及加密过的“预主密码”一起传给服务器。');

        var pageContent = function (data) {
            // HEADER
            doc.setFont('simsun'); // set font
            doc.setFontSize(20);
            doc.setTextColor(40);
            doc.setFontStyle('normal');
            doc.text("Report", data.settings.margin.left + 15, 22);

            // FOOTER
            var str = "Page 中文" + data.pageCount;
            // Total page number plugin only available in jspdf v1.0+
            if (typeof doc.putTotalPages === 'function') {
                str = str + " of " + totalPagesExp;
            }
            doc.setFontSize(10);
            doc.text(str, data.settings.margin.left, doc.internal.pageSize.height - 10);
        };
        var columnsLong = getColumns().concat([
            { title: "Title with\nlinebreak", dataKey: "text2" },
            { title: "Long text column", dataKey: "text" },
        ]);
        doc.autoTable(columnsLong, getData(1), {
            // startY: doc.autoTable.previous.finalY + 15,
            margin: { horizontal: 7 },
            bodyStyles: { valign: 'top' },
            styles: {
                overflow: 'linebreak', columnWidth: 'wrap',
                font: 'simsun'
            },
            // columnStyles: { text: { columnWidth: 'auto' } }
        });

        // doc.autoTable(getColumns(), getData(40), {
        //     addPageContent: pageContent,
        //     margin: { top: 90, bottom: 10 },
        //     styles: {
        //         overflow: 'linebreak',
        //         columnWidth: 'wrap',
        //         fillColor: [100, 255, 255],
        //         // font: "simsun"
        //     },
        //     columnStyles: { text: { columnWidth: 'auto' } },
        //     bodyStyles: { valign: 'top' },
        // });

        // Total page number plugin only available in jspdf v1.0+
        if (typeof doc.putTotalPages === 'function') {
            doc.putTotalPages(totalPagesExp);
        }

        return doc;
    };

    var doc = new pdfGen();
    doc.setFontSize(30);
    doc.setTextColor(153, 051, 102);
    doc.setCharSpace(3);




    // doc.save('custom_fonts.pdf');
    document.getElementById("output").src = doc.output('datauristring');

</script>

</html>